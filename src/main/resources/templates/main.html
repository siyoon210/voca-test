<!DOCTYPE html>
<!--[if lt IE 7]>
<html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html lang="en" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>단어 테스트</title>

    <!-- jQuery -->
    <script src="../static/js/jquery.min.js"></script>
    <!-- jsRender -->
    <script src="../static/js/jsrender.min.js"></script>
    <!-- jsViews -->
    <script src="../static/js/jsviews.min.js"></script>

    <link rel="import" href="range-select.html">

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="favicon.ico">

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/animate.css">
    <link rel="stylesheet" href="../static/css/style.css">


    <!-- Modernizr JS -->
    <script src="../static/js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="../static/js/respond.min.js"></script>
    <![endif]-->
</head>
<body class="container"></body>

<script>
    (function () {
        const domain = "http://localhost:8080";

        const data = {
            index: 0,
            step: 'form',
            bookId: 1,
            start: null,
            end: null,
            includeDerivative: false,
            size: undefined,
            vocaList: []
        };

        const eventHandlers = {
            requestData: function () {
                data.start = $('#start').val();
                data.end = $('#end').val();
                data.includeDerivative = $('#derivative').prop('checked');

                const url = function () {
                    let url =  domain + '/api/books/' + data.bookId + '/vocas'
                    + '?start=' + data.start + '&end=' + data.end;

                    if (data.includeDerivative) {
                        url += '&derivative=true';
                    }

                    return url;
                }();

                $.ajax({
                    url: url,
                    method: "get"
                }).done(function (res) {
                    console.log('SUCCESS', res[0]);
                    window.location.hash = '#ready';
                }).fail(function (res) {
                    console.log('ERROR', res);
                });
            }
        };

        function render(template, appendTarget) {
            console.log(data);
            $.templates(template).link(appendTarget || 'body', data, eventHandlers);
        }

        function get(url) {
            return new Promise(function (resolve, reject) {
                $.get(url, function (response) {
                    resolve(response);
                    reject(response);
                });
            });
        }

        const routes = {
            '': function () {
                get('range-select.html')
                    .then(template => render(template));
            },
            'ready': function () {
                get('ready.html')
                    .then(template => render(template));
            },
            otherwise() {
                root.innerHTML = `${location.hash} Not Found`;
            }
        };

        function router() {
            const hash = location.hash.replace('#', '');
            (routes[hash] || routes.otherwise)();
        }

        $(window).bind('hashchange', router);
        $(window).bind('DOMContentLoaded', router);
    }());
</script>

<!-- Bootstrap -->
<script src="../static/js/bootstrap.min.js"></script>
<!-- Placeholder -->
<script src="../static/js/jquery.placeholder.min.js"></script>
<!-- Waypoints -->
<script src="../static/js/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="../static/js/main.js"></script>

</html>